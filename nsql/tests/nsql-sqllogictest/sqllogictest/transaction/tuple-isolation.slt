statement ok
CREATE TABLE t(x int PRIMARY KEY);

statement ok
INSERT INTO t VALUES (1);

statement ok con0
BEGIN

statement ok con1
BEGIN

statement ok con2
BEGIN

statement ok con1
INSERT INTO t VALUES (2);

# con1 can see the row it inserted
query I con1
SELECT x from t;
----
1
2

# but no one else should be able to as it's not committed
query I con0
SELECT x from t;
----
1

query I con2
SELECT x from t;
----
1

query I con3
SELECT x from t;
----
1

statement ok con1
COMMIT;

# after con1 commits, con0 and con2 should still not be able to see the row due to SI
query I con0
SELECT x from t;
----
1

query I con2
SELECT x from t;
----
1

# however, a fresh connection should see the row
query I con4
SELECT x from t;
----
1
2

