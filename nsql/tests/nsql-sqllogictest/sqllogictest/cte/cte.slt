query error
WITH t AS (SELECT 1 AS x),
     t AS (SELECT 1)
SELECT * FROM t
----
common table expression with name `t` specified more than once

statement ok
CREATE TABLE t (x INTEGER PRIMARY KEY)

statement ok
INSERT INTO t VALUES (1), (2), (3)

# cte table takes precedence
query I
SELECT (WITH t AS (SELECT 1 AS x) SELECT x FROM t)
----
1

query I
WITH t AS (SELECT 1 AS x),
     u AS (SELECT 2 AS y)
SELECT x, y FROM t JOIN u
----
1 2


query I
WITH t AS (SELECT 1 AS x),
     u AS (SELECT x + 1 AS y FROM t)
SELECT x, y FROM t JOIN u
----
1 2

query I
WITH t AS (SELECT 1 AS x),
     u AS (SELECT x + 1 AS y FROM t),
     w AS (SELECT y + 1 AS z FROM u)
SELECT x, y, z FROM t JOIN u JOIN w
----
1 2 3

